{"version":3,"sources":["webpack:///C:/Users/20210408/Desktop/xcx/学习内容/2023/0120/uni-admin/components/batch-sms/batch-sms.vue?f9af","webpack:///C:/Users/20210408/Desktop/xcx/学习内容/2023/0120/uni-admin/components/batch-sms/batch-sms.vue?abf3","webpack:///C:/Users/20210408/Desktop/xcx/学习内容/2023/0120/uni-admin/components/batch-sms/batch-sms.vue?25cd","webpack:///C:/Users/20210408/Desktop/xcx/学习内容/2023/0120/uni-admin/components/batch-sms/batch-sms.vue?000e","uni-app:///components/batch-sms/batch-sms.vue","webpack:///C:/Users/20210408/Desktop/xcx/学习内容/2023/0120/uni-admin/components/batch-sms/batch-sms.vue?15d1","webpack:///C:/Users/20210408/Desktop/xcx/学习内容/2023/0120/uni-admin/components/batch-sms/batch-sms.vue?e3d4"],"names":["name","props","toType","receiver","type","default","data","smsTemplateLoading","smsTemplate","smsTemplateDataErrorMessage","smsDataModel","templateId","templateData","smsTemplateContent","smsPreviewContent","computed","isSelectedReceiver","sendAll","watch","handler","deep","methods","popupChange","open","close","loadSmsTemplate","uniSmsCo","customUI","res","item","value","text","onSmsTemplateSelected","templateVars","field","sendSms","isPreview","values","template","all","uni","title","content","success","e","taskName","confirmText","cancelText","chooseFile","showCancel","count","extension","file","reader","fail","parserFileJson","error","console","templates","reset"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsH;AACtH;AAC6D;AACL;AACc;;;AAGtE;AACwL;AACxL,gBAAgB,gLAAU;AAC1B,EAAE,+EAAM;AACR,EAAE,oFAAM;AACR,EAAE,6FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,wFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,aAAa,8RAEN;AACP,KAAK;AACL;AACA,aAAa,oSAEN;AACP,KAAK;AACL;AACA,aAAa,uTAEN;AACP,KAAK;AACL;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACnFA;AAAA;AAAA;AAAA;AAA+sB,CAAgB,koBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACwFnuB;AAAA,gBAEA;EACAA;EACAC;IACA;IACAC;IACA;IACAC;MACAC;MACAC;QACA;MACA;IACA;EAEA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;QACAV;QACAW;QACAC;MACA;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACA;IACA;IACAC;MACA;IACA;EACA;EACAC;IACAR;MACAS;QACA;QA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","file":"components/batch-sms/batch-sms.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./batch-sms.vue?vue&type=template&id=628e5452&\"\nvar renderjs\nimport script from \"./batch-sms.vue?vue&type=script&lang=js&\"\nexport * from \"./batch-sms.vue?vue&type=script&lang=js&\"\nimport style0 from \"./batch-sms.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/batch-sms/batch-sms.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./batch-sms.vue?vue&type=template&id=628e5452&\"","var components\ntry {\n  components = {\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uniForms: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-forms/components/uni-forms/uni-forms\" */ \"@/uni_modules/uni-forms/components/uni-forms/uni-forms.vue\"\n      )\n    },\n    uniFormsItem: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-forms/components/uni-forms-item/uni-forms-item\" */ \"@/uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.vue\"\n      )\n    },\n    uniEasyinput: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput\" */ \"@/uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.vue\"\n      )\n    },\n    uniDataSelect: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-data-select/components/uni-data-select/uni-data-select\" */ \"@/uni_modules/uni-data-select/components/uni-data-select/uni-data-select.vue\"\n      )\n    },\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 =\n    _vm.toType === \"user\" && _vm.isSelectedReceiver ? _vm.receiver.length : null\n  var g1 = !(_vm.toType === \"user\") ? _vm.receiver.length : null\n  var g2 = !_vm.smsTemplateLoading ? _vm.smsTemplate.length : null\n  var g3 = _vm.smsDataModel.templateData.length\n  var g4 = _vm.smsPreviewContent.length\n  var g5 = g4 ? _vm.smsPreviewContent[0].length : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      return _vm.$refs.previewPopup.close()\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n        g3: g3,\n        g4: g4,\n        g5: g5,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./batch-sms.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./batch-sms.vue?vue&type=script&lang=js&\"","<template>\r\n    <view>\r\n        <uni-popup ref=\"smsPopup\" type=\"center\" @change=\"popupChange\" :is-mask-click=\"false\">\r\n            <view class=\"sms-manager\">\r\n                <view class=\"sms-manager--header mb\">群发短信</view>\r\n                <uni-forms :label-width=\"100\" :modelValue=\"smsDataModel\" ref=\"smsForm\">\r\n                    <uni-forms-item label=\"目标对象\" v-if=\"toType === 'user'\">\r\n                        <view v-if=\"isSelectedReceiver\">当前已选择{{ receiver.length }}人</view>\r\n                        <view v-else>全部用户</view>\r\n                        <view class=\"sms-data-tip\">如需给指定用户发送，请在列表选择要发送的用户。</view>\r\n                    </uni-forms-item>\r\n                    <uni-forms-item label=\"目标对象\" v-else>\r\n                        <view>当前已选择{{ receiver.length }}个标签</view>\r\n                        <view class=\"sms-data-tip\">如标签关联的用户没有绑定手机号，将不会发送短信。</view>\r\n                    </uni-forms-item>\r\n                    <uni-forms-item label=\"任务名称\" name=\"name\" required\r\n                        :rules=\"[{ required: true, errorMessage: '请输入任务名称' }]\">\r\n                        <uni-easyinput v-model=\"smsDataModel.name\" placeholder=\"请输入任务名称，例如 “放假通知”\" />\r\n                    </uni-forms-item>\r\n                    <uni-forms-item required label=\"短信模板\" name=\"templateId\"\r\n                        :rules=\"[{ required: true, errorMessage: '请选择短信模板' }]\">\r\n\t\t\t\t\t\t<template v-if=\"!smsTemplateLoading\">\r\n\t\t\t\t\t\t\t<view v-if=\"smsTemplate.length\">\r\n\t\t\t\t\t\t\t\t<uni-data-select class=\"type m\" placeholder=\"请选择短信模板\" size=\"mini\" :clear=\"false\"\r\n\t\t\t\t\t\t\t\t\t:localdata=\"smsTemplate\" v-model=\"smsDataModel.templateId\"\r\n\t\t\t\t\t\t\t\t\t@change=\"onSmsTemplateSelected\">\r\n\t\t\t\t\t\t\t\t</uni-data-select>\r\n\t\t\t\t\t\t\t\t<view class=\"sms-data-tip\">\r\n\t\t\t\t\t\t\t\t\t导入短信模版参考<a class=\"a-link\" href=\"https://uniapp.dcloud.net.cn/uniCloud/admin.html#群发短信\" target=\"_blank\">教程</a>；若有新的短信模版，可<text @click=\"chooseFile\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"a-link\">点此导入</text>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view v-else>\r\n\t\t\t\t\t\t\t\t<button @click=\"chooseFile\" type=\"primary\" style=\"width: 120px;\"\r\n\t\t\t\t\t\t\t\t\tsize=\"mini\">上传短信模板</button>\r\n\t\t\t\t\t\t\t\t<view class=\"sms-data-tip\">当前未导入短信模板，请从dev.dcloud.net.cn的短信-<a href=\"https://dev.dcloud.net.cn/pages/sms/template\" target=\"_blank\">模板配置</a>中导出短信模版，并在此导入。教程<a href=\"https://uniapp.dcloud.net.cn/uniCloud/admin.html#batch-sms\" target=\"_blank\">详见</a></view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<template v-else>\r\n\t\t\t\t\t\t\t模板加载中...\r\n\t\t\t\t\t\t</template>\r\n                    </uni-forms-item>\r\n                    <uni-forms-item label=\"短信内容\" v-if=\"smsTemplateContent\">\r\n                        <view class=\"form-item-flex-center\">{{smsTemplateContent}}</view>\r\n                    </uni-forms-item>\r\n                    <uni-forms-item label=\"模板变量配置\" :error-message=\"smsTemplateDataErrorMessage\"\r\n                        v-if=\"smsDataModel.templateData.length\">\r\n                        <view class=\"sms-data-item\" :key=\"template.field\"\r\n                            v-for=\"(template, index) in smsDataModel.templateData\">\r\n                            <uni-easyinput class=\"field m\" v-model=\"template.field\" placeholder=\"字段\" :clearable=\"false\"\r\n                                :disabled=\"true\" style=\"width: 120px;flex:none;\" />\r\n                            <uni-easyinput class=\"value m\" v-model=\"template.value\"\r\n                                placeholder=\"例 {uni-id-users.username}\" :clearable=\"false\" />\r\n                        </view>\r\n                        <view class=\"sms-data-tip\">短信变量支持固定值和数据表查询两种方式；固定值如：各位同事，数据表查询如：{uni-id-users.username}；请注意，若使用数据表查询方式，目前仅支持查询 uni-id-users 表；并注意确保数据库中查询字段值不为空，否则短信将发送失败。</view>\r\n                    </uni-forms-item>\r\n                </uni-forms>\r\n                <view class=\"uni-group\">\r\n                    <button @click=\"sendSms(true)\" class=\"uni-button\">预览</button>\r\n                    <button @click=\"sendSms()\" class=\"uni-button\" type=\"primary\">提交</button>\r\n                </view>\r\n            </view>\r\n            <uni-icons type=\"closeempty\" size=\"24\" class=\"close\" @click=\"close\"></uni-icons>\r\n        </uni-popup>\r\n        <uni-popup ref=\"previewPopup\" type=\"center\" :is-mask-click=\"false\">\r\n            <view class=\"sms-manager preview\">\r\n                <view class=\"sms-manager--header mb\">\r\n                    <view>短信预览</view>\r\n                    <view class=\"sub-title\">仅预览第一条短信内容</view>\r\n                </view>\r\n                <view class=\"content\">\r\n                    <view v-for=\"(content,index) of smsPreviewContent\" :key=\"index\">{{content}}</view>\r\n                    <view class=\"length\">短信字数：<text class=\"num\">{{smsPreviewContent.length ? smsPreviewContent[0].length : 0}}</text>字</view>\r\n                </view>\r\n                <view class=\"tip\">\r\n                    <view>说明：</view>\r\n                    <view>若从数据表中查询，字段内容长度会影响总字数，短信字数＝短信签名字数+短信内容字数。</view>\r\n                    <view>短信长度不超过70个字，按照一条短信计费；超过70个字，按照67字/条拆分成多条计费。</view>\r\n                </view>\r\n                <view class=\"uni-group\">\r\n                    <button @click=\"$refs.previewPopup.close()\" class=\"uni-button\">关闭</button>\r\n                </view>\r\n            </view>\r\n        </uni-popup>\r\n    </view>\r\n</template>\r\n\r\n<script>\r\nconst uniSmsCo = uniCloud.importObject('uni-sms-co')\r\n\r\nexport default {\r\n    name: 'batchSms',\r\n    props: {\r\n        // 发送类型 user|userTags\r\n        toType: String,\r\n        // 接收者 user=user._id, userTags=tag.id\r\n        receiver: {\r\n            type: Array,\r\n            default() {\r\n                return []\r\n            }\r\n        },\r\n\r\n    },\r\n    data() {\r\n        return {\r\n\t\t\tsmsTemplateLoading: false,\r\n            smsTemplate: [],\r\n            smsTemplateDataErrorMessage: '',\r\n            smsDataModel: {\r\n                name: '',\r\n                templateId: '',\r\n                templateData: []\r\n            },\r\n            smsTemplateContent: '',\r\n            smsPreviewContent: [],\r\n        }\r\n    },\r\n    computed: {\r\n        isSelectedReceiver() {\r\n            return !!this.receiver.length\r\n        },\r\n        sendAll() {\r\n            return !this.isSelectedReceiver || this.toType === 'userTags'\r\n        }\r\n    },\r\n    watch: {\r\n        smsDataModel: {\r\n            handler(smsDataModel) {\r\n                if (!smsDataModel.templateId) return ''\r\n\r\n                const template = this.smsTemplate.find(template => template.value === smsDataModel.templateId)\r\n                let content = smsDataModel.templateData.reduce((res, param) => {\r\n                    const reg = new RegExp(`\\\\$\\\\{${param.field}\\\\}`)\r\n                    return res.replace(reg, ($1) => param.value || $1)\r\n                }, template.content)\r\n\r\n                this.smsTemplateContent = `【${template.sign}】${content}`\r\n            },\r\n            deep: true\r\n        }\r\n    },\r\n    methods: {\r\n        popupChange(e) {\r\n            if (!e.show) this.reset()\r\n        },\r\n        open() {\r\n            this.$refs.smsPopup.open()\r\n\t\t\tthis.loadSmsTemplate()\r\n        },\r\n        close() {\r\n            this.reset()\r\n            this.$refs.smsPopup.close()\r\n        },\r\n\t\tasync loadSmsTemplate () {\r\n\t\t\tif (this.smsTemplate.length > 0 || this.smsTemplateLoading) return\r\n\r\n\t\t\tthis.smsTemplateLoading = true\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst uniSmsCo = uniCloud.importObject('uni-sms-co', {customUI: true})\r\n\t\t\t\tconst res = await uniSmsCo.template()\r\n\t\t\t\tthis.smsTemplate = res.map(item => ({\r\n\t\t\t\t\t...item,\r\n\t\t\t\t\tvalue: item._id,\r\n\t\t\t\t\ttext: item.name,\r\n\t\t\t\t}))\r\n\t\t\t} finally {\r\n\t\t\t\tthis.smsTemplateLoading = false\r\n\t\t\t}\r\n\t\t},\r\n        onSmsTemplateSelected(templateId) {\r\n            const current = this.smsTemplate.find(template => template.value === templateId)\r\n\r\n            if (!current) return\r\n\r\n            const reg = new RegExp(/\\$\\{(.*?)\\}/g)\r\n            let templateVars = []\r\n            let _execResult\r\n\r\n            while (_execResult = reg.exec(current.content)) {\r\n                const param = _execResult[1]\r\n\r\n                if (param) {\r\n                    templateVars.push({\r\n                        field: param,\r\n                        value: ''\r\n                    })\r\n                }\r\n            }\r\n\r\n            this.smsDataModel.templateData = templateVars\r\n        },\r\n        async sendSms(isPreview = false) {\r\n            const values = await this.$refs.smsForm.validate()\r\n            const receiver = this.receiver\r\n\r\n            for (const template of this.smsDataModel.templateData) {\r\n                if (!template.value) {\r\n                    this.smsTemplateDataErrorMessage = '字段/值不可为空'\r\n                    return\r\n                }\r\n            }\r\n            this.smsTemplateDataErrorMessage = ''\r\n\r\n            if (isPreview) {\r\n                const res = await uniSmsCo.preview(\r\n                    {\r\n                        all: this.sendAll,\r\n                        type: this.toType,\r\n                        receiver\r\n                    },\r\n                    values.templateId,\r\n                    this.smsDataModel.templateData\r\n                )\r\n\r\n                if (res.errCode === 0) {\r\n                    this.smsPreviewContent = res.list\r\n                    this.$refs.previewPopup.open()\r\n                    return\r\n                }\r\n            }\r\n\r\n            uni.showModal({\r\n                title: '发送确认',\r\n                content: `短信${this.sendAll ? '将发送给所有用户' : `预计发送${this.receiver.length}人`}，确定发送？`,\r\n                success: async (e) => {\r\n                    if (e.cancel) return\r\n\r\n                    const res = await uniSmsCo.createSmsTask({\r\n                        all: this.sendAll,\r\n                        type: this.toType,\r\n                        receiver\r\n                    },\r\n                        values.templateId,\r\n                        this.smsDataModel.templateData, {\r\n                        taskName: values.name\r\n                    }\r\n                    )\r\n\r\n                    if (res.taskId) {\r\n                        uni.showModal({\r\n                            content: '短信任务已提交，您可在DCloud开发者后台查看短信发送记录',\r\n                            confirmText: '立即查看',\r\n                            cancelText: '关闭',\r\n                            success: (e) => {\r\n                                if (e.cancel) {\r\n                                    this.reset()\r\n                                    this.$refs.smsPopup.close()\r\n                                } else {\r\n                                    // #ifdef H5\r\n                                    window.open('https://dev.dcloud.net.cn/#/pages/sms/sendLog', '_blank')\r\n                                    // #endif\r\n                                    // ifndef H5\r\n                                    this.reset()\r\n                                    this.$refs.smsPopup.close()\r\n                                    // endif\r\n                                }\r\n                            }\r\n                        })\r\n                    }\r\n                }\r\n            })\r\n        },\r\n        chooseFile() {\r\n            if (typeof window.FileReader === 'undefined') {\r\n                uni.showModal({\r\n                    content: '当前浏览器不支持文件上传，请升级浏览器重试',\r\n                    showCancel: false\r\n                })\r\n                return\r\n            }\r\n\r\n            uni.chooseFile({\r\n                count: 1,\r\n                extension: ['.json'],\r\n                success: ({ tempFiles }) => {\r\n                    if (tempFiles.length <= 0) return\r\n                    const [file] = tempFiles\r\n                    const reader = new FileReader()\r\n\r\n                    reader.readAsText(file)\r\n                    reader.onload = () => this.parserFileJson(null, reader.result)\r\n                    reader.onerror = () => this.parserFileJson(reader.error)\r\n                },\r\n                fail: () => {\r\n                    uni.showModal({\r\n                        content: '打开选择文件框失败',\r\n                        showCancel: false\r\n                    })\r\n                }\r\n            })\r\n        },\r\n        async parserFileJson(error, fileContent) {\r\n            if (error) {\r\n                console.error(error)\r\n                uni.showModal({\r\n                    content: '文件读取失败，请重新上传文件',\r\n                    showCancel: false\r\n                })\r\n                return\r\n            }\r\n\r\n            let templates = []\r\n            try {\r\n                templates = JSON.parse(fileContent)\r\n            } catch (e) {\r\n                console.error(e)\r\n                uni.showModal({\r\n                    content: '短信模板解析失败，请检查模板格式',\r\n                    showCancel: false\r\n                })\r\n                return\r\n            }\r\n\r\n            const res = await uniSmsCo.updateTemplates(templates)\r\n            if (res.errCode === 0) {\r\n                uni.showModal({\r\n                    content: '短信模板更新成功',\r\n                    showCancel: false,\r\n                    success: () => {\r\n\t\t\t\t\t\tthis.loadSmsTemplate()\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        reset() {\r\n            this.smsDataModel.name = ''\r\n            this.smsDataModel.templateId = ''\r\n            this.smsDataModel.templateData = []\r\n            this.smsPreviewContent = []\r\n            this.smsTemplateContent = ''\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n@import '@/uni_modules/uni-scss/variables.scss';\r\n\r\n.a-link {\r\n    cursor: pointer;\r\n    color: $uni-primary;\r\n    text-decoration: none;\r\n}\r\n\r\n.close {\r\n    position: absolute;\r\n    right: 20px;\r\n    top: 20px;\r\n    cursor: pointer;\r\n}\r\n\r\n.sms-manager {\r\n    width: 570px;\r\n    background: #fff;\r\n    padding: 30px;\r\n    border-radius: 5px;\r\n    &.preview {\r\n        width: 550px;\r\n    }\r\n    &--header {\r\n        text-align: center;\r\n        font-size: 22px;\r\n\r\n        &.mb {\r\n            margin-bottom: 50px;\r\n        }\r\n        .sub-title {\r\n            margin-top: 5px;\r\n            font-size: 16px;\r\n            color: #999;\r\n        }\r\n    }\r\n    .content {\r\n        margin-top: 20px;\r\n        font-size: 16px;\r\n        line-height: 1.5;\r\n        .length {\r\n            text-align: right;\r\n            font-size: 13px;\r\n            margin-top: 20px;\r\n            .num {\r\n                color: red;\r\n            }\r\n        }\r\n    }\r\n    .tip {\r\n        border-top: #ccc solid 1px;\r\n        padding-top: 20px;\r\n        margin-top: 20px;\r\n        line-height: 1.7;\r\n        font-size: 13px;\r\n\t\tcolor: #999;\r\n    }\r\n}\r\n\r\n.sms-data-item {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-top: 10px;\r\n\r\n    &:first-child {\r\n        margin-top: 0;\r\n    }\r\n\r\n    .m {\r\n        margin: 0 5px;\r\n\r\n        &:first-child {\r\n            margin-left: 0;\r\n        }\r\n\r\n        &:last-child {\r\n            margin-right: 0;\r\n        }\r\n    }\r\n\r\n    //.options {\r\n    //  display: flex;\r\n    //  align-content: center;\r\n    //}\r\n    .field {\r\n        // flex: 1;\r\n    }\r\n\r\n    .type {\r\n        width: 100px;\r\n        flex: none;\r\n    }\r\n\r\n    .value {\r\n        // width: 80px;\r\n    }\r\n\r\n    .add,\r\n    .minus {\r\n        cursor: pointer;\r\n    }\r\n}\r\n\r\n.sms-data-tip {\r\n    color: $uni-info;\r\n    font-size: 12px;\r\n    margin-top: 5px;\r\n}\r\n\r\n.form-item-flex-center {\r\n    height: 100%;\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./batch-sms.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../yl/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./batch-sms.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1679034105575\n      var cssReload = require(\"C:/yl/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}