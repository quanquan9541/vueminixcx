(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-Mcamera-edit"],{"32e3":function(e,t,a){"use strict";a.r(t);var n=a("e425"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=r.a},"34a7":function(e,t,a){"use strict";(function(e,n){a("7a82");var r=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.codeeditid=function(e){return"200"==e||"400"==e?e:"success"},t.gettreedata=function(e,t){return s.apply(this,arguments)},t.phonevalue=function(e,t){return d.apply(this,arguments)},t.relevance=function(e){return c.apply(this,arguments)},a("a9e3");var i=r(a("5530")),u=r(a("c7eb")),o=r(a("1da1")),l=e.database();function s(){return s=(0,o.default)((0,u.default)().mark((function e(t,a){var r,i;return(0,u.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=["Mcamera","Mmoney"],e.next=3,l.collection(r[t]).where(a).get();case 3:return i=e.sent,n.log(i.result.data),e.abrupt("return",i.result.data);case 6:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function c(){return c=(0,o.default)((0,u.default)().mark((function e(t){var a,r,i;return(0,u.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.detail.value[2]){e.next=4;break}return e.abrupt("return","200");case 4:return a=t.detail.value[2].value,e.next=7,l.collection("Mparameter").where("title=='".concat(a,"'")).field("_id").get({getOne:!0});case 7:if(r=e.sent,n.log(r),r.result.data){e.next=13;break}return e.abrupt("return","400");case 13:return i=r.result.data._id,e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function d(){return d=(0,o.default)((0,u.default)().mark((function e(t,a){var r,o,s,c,d,f,m=arguments;return(0,u.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=m.length>2&&void 0!==m[2]?m[2]:"add",o={},o.phone_id=t.title,e.next=5,l.collection("Msoc").where("_id=='".concat(t.socfunction,"'")).field("_id,socvalue").get({getOne:!0});case 5:return s=e.sent,o.phonefunction=String(s.result.data.socvalue),c={},c.weight=String(t.weight),c.measurement=Number(t.measurementHight)*Number(t.measurementWidth)*Number(t.measurementThickness),o.light_thin=c,d=Number(t.screenPPI)*Number(t.screenMaterial)/50+(Number(t.screenRenovate)-60)/60+Number(t.screenAdmin)/10-1,o.phoneshow=String(Number(d.toFixed(2))),e.next=15,l.collection("Mcamera").where("phone_id=='".concat(t.title,"'")).groupBy("phone_id").groupField("sum(add(Comeravalue,Comeraadd)) as sumScore ").get({getOne:!0});case 15:f=e.sent,o.phoneimage=String(f.result.data.sumScore),o.phonecell=String(t.cell),o.phonecharge=String(Number(t.WiredCharging)+Number(t.WirelessCharging)/4),"add"==r?l.collection("Mphonevalue").add((0,i.default)({},o)).then((function(e){n.log("上传",e)})).catch((function(e){n.log("上传失败",e)})):l.collection("Mphonevalue").doc(a).update((0,i.default)((0,i.default)({},o),{},{last_date:Date.now()})).then((function(e){n.log("修改",e)})).catch((function(e){n.log("修改失败",e)}));case 20:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}}).call(this,a("a9ff")["default"],a("5a52")["default"])},b9e5:function(e,t,a){"use strict";a.r(t);var n=a("ee10"),r=a("32e3");for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);var u=a("f0c5"),o=Object(u["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=o.exports},cb79:function(e,t,a){"use strict";a("7a82");var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.enumConverter=void 0,t.filterToWhere=function(e,t){var a={};for(var n in e){var u=e[n],o=u.type,l=u.value;switch(o){case"search":"string"===typeof l&&l.length&&(a[n]=new RegExp(l));break;case"select":if(l.length){var s,c=[],d=(0,i.default)(l);try{for(d.s();!(s=d.n()).done;){var f=s.value;c.push(t.eq(f))}}catch(D){d.e(D)}finally{d.f()}a[n]=t.or(c)}break;case"range":if(l.length){var m=l[0],v=l[1];a[n]=t.and([t.gte(m),t.lte(v)])}break;case"date":if(l.length){var p=(0,r.default)(l,2),h=p[0],b=p[1],g=new Date(h),x=new Date(b);a[n]=t.and([t.gte(g),t.lte(x)])}break;case"timestamp":if(l.length){var y=(0,r.default)(l,2),C=y[0],w=y[1];a[n]=t.and([t.gte(C),t.lte(w)])}break}}return a},t.validator=void 0;var r=n(a("3835")),i=n(a("b85c"));a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("25f0"),a("14d9");t.validator={phone_id:{rules:[{format:"string"}],title:"名称",label:"名称"},edit:{rules:[{format:"string"}],title:"关联",label:"关联"},ComeraType:{rules:[{required:!0},{format:"string"},{range:[{text:"前置",value:"前置"},{text:"主摄",value:"主摄"},{text:"广角",value:"广角"},{text:"长焦",value:"长焦"},{text:"人像",value:"人像"},{text:"微距",value:"微距"},{text:"景深",value:"景深"},{text:"其他",value:"其他"}]}],title:"类型",label:"类型"},Comeraedit:{rules:[{required:!0},{format:"string"}],title:"详情",label:"详情"},Comeravalue:{rules:[{required:!0},{format:"int"}],title:"数值",label:"数值"},Comeraadd:{rules:[{format:"int"}],title:"附加分",defaultValue:0,label:"附加分"},sort:{rules:[{format:"int"}],title:"排序",defaultValue:0,label:"排序"}};t.enumConverter={ComeraType_valuetotext:{"前置":"前置","主摄":"主摄","广角":"广角","长焦":"长焦","人像":"人像","微距":"微距","景深":"景深","其他":"其他"}}},e425:function(e,t,a){"use strict";(function(e){a("7a82");var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("c7eb")),i=n(a("1da1")),u=n(a("5530"));a("caad"),a("2532"),a("b64b"),a("d3b7");var o=a("cb79"),l=a("34a7"),s=e.database();s.command;function c(e){var t={};for(var a in o.validator)e.includes(a)&&(t[a]=o.validator[a]);return t}var d={data:function(){var e={phone_id:"",edit:"",ComeraType:"",Comeraedit:"",Comeravalue:null,Comeraadd:0,sort:0};return{formData:e,formOptions:{ComeraType_localdata:[{text:"前置",value:"前置"},{text:"主摄",value:"主摄"},{text:"广角",value:"广角"},{text:"长焦",value:"长焦"},{text:"人像",value:"人像"},{text:"微距",value:"微距"},{text:"景深",value:"景深"},{text:"其他",value:"其他"}]},rules:(0,u.default)({},c(Object.keys(e)))}},onLoad:function(e){if(e.id){var t=e.id;this.formDataId=t,this.getDetail(t)}},onReady:function(){this.$refs.form.setRules(this.rules)},methods:{onchange:function(e){var t=this;return(0,i.default)((0,r.default)().mark((function a(){var n;return(0,r.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,(0,l.relevance)(e);case 2:if(n=a.sent,"200"!=n){a.next=6;break}return setTimeout((function(){t.formData.phone_id=null}),800),a.abrupt("return");case 6:t.formData.edit=n;case 7:case"end":return a.stop()}}),a)})))()},submit:function(){var e=this;uni.showLoading({mask:!0}),this.$refs.form.validate().then((function(t){return e.submitForm(t)})).catch((function(){})).finally((function(){uni.hideLoading()}))},submitForm:function(e){var t=this;return s.collection("Mcamera").doc(this.formDataId).update(e).then((function(e){uni.showToast({title:"修改成功"}),t.getOpenerEventChannel().emit("refreshData"),setTimeout((function(){return uni.navigateBack()}),500)})).catch((function(e){uni.showModal({content:e.message||"请求服务失败",showCancel:!1})}))},getDetail:function(e){var t=this;uni.showLoading({mask:!0}),s.collection("Mcamera").doc(e).field("phone_id,edit,ComeraType,Comeraedit,Comeravalue,Comeraadd,sort").get().then((function(e){var a=e.result.data[0];a&&(t.formData=a)})).catch((function(e){uni.showModal({content:e.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))}}};t.default=d}).call(this,a("a9ff")["default"])},ee10:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return n}));var n={uniForms:a("2b75").default,uniFormsItem:a("4194").default,uniDataPicker:a("9aad").default,uniEasyinput:a("8e06").default,uniDataCheckbox:a("ddbd").default},r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"uni-container"},[a("uni-forms",{ref:"form",attrs:{model:e.formData,validateTrigger:"bind"}},[a("uni-forms-item",{attrs:{name:"phone_id",label:"名称"}},[a("uni-data-picker",{attrs:{collection:"Manufacturer_brand","parent-field":"parent_id.value",placeholder:"请选择型号","self-field":"_id",field:"_id as value, name as text"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.onchange.apply(void 0,arguments)}},model:{value:e.formData.phone_id,callback:function(t){e.$set(e.formData,"phone_id",t)},expression:"formData.phone_id"}})],1),a("uni-forms-item",{attrs:{name:"edit",label:"关联"}},[a("uni-easyinput",{attrs:{disabled:!0,placeholder:"参数关联"},model:{value:e.formData.edit,callback:function(t){e.$set(e.formData,"edit",t)},expression:"formData.edit"}})],1),a("uni-forms-item",{attrs:{name:"ComeraType",label:"类型",required:!0}},[a("uni-data-checkbox",{attrs:{localdata:e.formOptions.ComeraType_localdata},model:{value:e.formData.ComeraType,callback:function(t){e.$set(e.formData,"ComeraType",t)},expression:"formData.ComeraType"}})],1),a("uni-forms-item",{attrs:{name:"Comeraedit",label:"详情",required:!0}},[a("uni-easyinput",{attrs:{placeholder:"相机详情"},model:{value:e.formData.Comeraedit,callback:function(t){e.$set(e.formData,"Comeraedit",t)},expression:"formData.Comeraedit"}})],1),a("uni-forms-item",{attrs:{name:"Comeravalue",label:"数值",required:!0}},[a("uni-easyinput",{attrs:{placeholder:"相机数值644",type:"number"},model:{value:e.formData.Comeravalue,callback:function(t){e.$set(e.formData,"Comeravalue",t)},expression:"formData.Comeravalue"}})],1),a("uni-forms-item",{attrs:{name:"Comeraadd",label:"附加分"}},[a("uni-easyinput",{attrs:{placeholder:"特别加分",type:"number"},model:{value:e.formData.Comeraadd,callback:function(t){e.$set(e.formData,"Comeraadd",t)},expression:"formData.Comeraadd"}})],1),a("uni-forms-item",{attrs:{name:"sort",label:"排序"}},[a("uni-easyinput",{attrs:{type:"number"},model:{value:e.formData.sort,callback:function(t){e.$set(e.formData,"sort",t)},expression:"formData.sort"}})],1),a("v-uni-view",{staticClass:"uni-button-group"},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}},[e._v("提交")]),a("v-uni-navigator",{staticStyle:{"margin-left":"15px"},attrs:{"open-type":"navigateBack"}},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"}},[e._v("返回")])],1)],1)],1)],1)},i=[]}}]);