(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-Mmoney-edit"],{"34a7":function(e,t,a){"use strict";(function(e,n){a("7a82");var r=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.codeeditid=function(e){return"200"==e||"400"==e?e:"success"},t.gettreedata=function(e,t){return c.apply(this,arguments)},t.phonevalue=function(e,t){return d.apply(this,arguments)},t.relevance=function(e){return s.apply(this,arguments)},a("a9e3");var i=r(a("5530")),u=r(a("c7eb")),o=r(a("1da1")),l=e.database();function c(){return c=(0,o.default)((0,u.default)().mark((function e(t,a){var r,i;return(0,u.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=["Mcamera","Mmoney"],e.next=3,l.collection(r[t]).where(a).get();case 3:return i=e.sent,n.log(i.result.data),e.abrupt("return",i.result.data);case 6:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function s(){return s=(0,o.default)((0,u.default)().mark((function e(t){var a,r,i;return(0,u.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.detail.value[2]){e.next=4;break}return e.abrupt("return","200");case 4:return a=t.detail.value[2].value,e.next=7,l.collection("Mparameter").where("title=='".concat(a,"'")).field("_id").get({getOne:!0});case 7:if(r=e.sent,n.log(r),r.result.data){e.next=13;break}return e.abrupt("return","400");case 13:return i=r.result.data._id,e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function d(){return d=(0,o.default)((0,u.default)().mark((function e(t,a){var r,o,c,s,d,f,m=arguments;return(0,u.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=m.length>2&&void 0!==m[2]?m[2]:"add",o={},o.phone_id=t.title,e.next=5,l.collection("Msoc").where("_id=='".concat(t.socfunction,"'")).field("_id,socvalue").get({getOne:!0});case 5:return c=e.sent,o.phonefunction=String(c.result.data.socvalue),s={},s.weight=String(t.weight),s.measurement=Number(t.measurementHight)*Number(t.measurementWidth)*Number(t.measurementThickness),o.light_thin=s,d=Number(t.screenPPI)*Number(t.screenMaterial)/50+(Number(t.screenRenovate)-60)/60+Number(t.screenAdmin)/10-1,o.phoneshow=String(Number(d.toFixed(2))),e.next=15,l.collection("Mcamera").where("phone_id=='".concat(t.title,"'")).groupBy("phone_id").groupField("sum(add(Comeravalue,Comeraadd)) as sumScore ").get({getOne:!0});case 15:f=e.sent,o.phoneimage=String(f.result.data.sumScore),o.phonecell=String(t.cell),o.phonecharge=String(Number(t.WiredCharging)+Number(t.WirelessCharging)/4),"add"==r?l.collection("Mphonevalue").add((0,i.default)({},o)).then((function(e){n.log("上传",e)})).catch((function(e){n.log("上传失败",e)})):l.collection("Mphonevalue").doc(a).update((0,i.default)((0,i.default)({},o),{},{last_date:Date.now()})).then((function(e){n.log("修改",e)})).catch((function(e){n.log("修改失败",e)}));case 20:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}}).call(this,a("a9ff")["default"],a("5a52")["default"])},6630:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return n}));var n={uniForms:a("2b75").default,uniFormsItem:a("4194").default,uniDataPicker:a("9aad").default,uniEasyinput:a("8e06").default,uniDataCheckbox:a("ddbd").default},r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"uni-container"},[a("uni-forms",{ref:"form",attrs:{model:e.formData,validateTrigger:"bind"}},[a("uni-forms-item",{attrs:{name:"phone_id",label:"名称"}},[a("uni-data-picker",{attrs:{collection:"Manufacturer_brand","parent-field":"parent_id.value",placeholder:"请选择型号","self-field":"_id",field:"_id as value, name as text"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.onchange.apply(void 0,arguments)}},model:{value:e.formData.phone_id,callback:function(t){e.$set(e.formData,"phone_id",t)},expression:"formData.phone_id"}})],1),a("uni-forms-item",{attrs:{name:"edit",label:"关联"}},[a("uni-easyinput",{attrs:{disabled:!0,placeholder:"参数关联"},model:{value:e.formData.edit,callback:function(t){e.$set(e.formData,"edit",t)},expression:"formData.edit"}})],1),a("uni-forms-item",{attrs:{name:"ram",label:"内存",required:!0}},[a("uni-data-checkbox",{attrs:{localdata:e.formOptions.ram_localdata},model:{value:e.formData.ram,callback:function(t){e.$set(e.formData,"ram",t)},expression:"formData.ram"}})],1),a("uni-forms-item",{attrs:{name:"rom",label:"闪存",required:!0}},[a("uni-data-checkbox",{attrs:{localdata:e.formOptions.rom_localdata},model:{value:e.formData.rom,callback:function(t){e.$set(e.formData,"rom",t)},expression:"formData.rom"}})],1),a("uni-forms-item",{attrs:{name:"money",label:"价格"}},[a("uni-easyinput",{attrs:{placeholder:"价格表"},model:{value:e.formData.money,callback:function(t){e.$set(e.formData,"money",t)},expression:"formData.money"}})],1),a("uni-forms-item",{attrs:{name:"sort",label:"排序"}},[a("uni-easyinput",{attrs:{type:"number"},model:{value:e.formData.sort,callback:function(t){e.$set(e.formData,"sort",t)},expression:"formData.sort"}})],1),a("v-uni-view",{staticClass:"uni-button-group"},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}},[e._v("提交")]),a("v-uni-navigator",{staticStyle:{"margin-left":"15px"},attrs:{"open-type":"navigateBack"}},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"}},[e._v("返回")])],1)],1)],1)],1)},i=[]},"73a5":function(e,t,a){"use strict";a("7a82");var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.enumConverter=void 0,t.filterToWhere=function(e,t){var a={};for(var n in e){var u=e[n],o=u.type,l=u.value;switch(o){case"search":"string"===typeof l&&l.length&&(a[n]=new RegExp(l));break;case"select":if(l.length){var c,s=[],d=(0,i.default)(l);try{for(d.s();!(c=d.n()).done;){var f=c.value;s.push(t.eq(f))}}catch(D){d.e(D)}finally{d.f()}a[n]=t.or(s)}break;case"range":if(l.length){var m=l[0],v=l[1];a[n]=t.and([t.gte(m),t.lte(v)])}break;case"date":if(l.length){var h=(0,r.default)(l,2),p=h[0],b=h[1],g=new Date(p),x=new Date(b);a[n]=t.and([t.gte(g),t.lte(x)])}break;case"timestamp":if(l.length){var y=(0,r.default)(l,2),w=y[0],_=y[1];a[n]=t.and([t.gte(w),t.lte(_)])}break}}return a},t.validator=void 0;var r=n(a("3835")),i=n(a("b85c"));a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("25f0"),a("14d9");t.validator={phone_id:{rules:[{format:"string"}],title:"名称",label:"名称"},edit:{rules:[{format:"string"}],title:"关联",label:"关联"},ram:{rules:[{required:!0},{format:"int"},{range:[{value:4,text:4},{value:6,text:6},{value:8,text:8},{value:12,text:12},{value:16,text:16},{value:18,text:18}]}],title:"内存",label:"内存"},rom:{rules:[{required:!0},{format:"int"},{range:[{value:32,text:32},{value:64,text:64},{value:128,text:128},{value:256,text:256},{value:512,text:512},{value:1024,text:1024}]}],title:"闪存",label:"闪存"},money:{rules:[{format:"string"}],title:"价格",label:"价格"},sort:{rules:[{format:"int"}],title:"排序",defaultValue:0,label:"排序"}};t.enumConverter={ram_valuetotext:{4:4,6:6,8:8,12:12,16:16,18:18},rom_valuetotext:{32:32,64:64,128:128,256:256,512:512,1024:1024}}},"9a51":function(e,t,a){"use strict";a.r(t);var n=a("6630"),r=a("c204");for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);var u=a("f0c5"),o=Object(u["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=o.exports},c204:function(e,t,a){"use strict";a.r(t);var n=a("c2a2"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=r.a},c2a2:function(e,t,a){"use strict";(function(e){a("7a82");var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("c7eb")),i=n(a("1da1")),u=n(a("5530"));a("caad"),a("2532"),a("b64b"),a("d3b7");var o=a("73a5"),l=a("34a7"),c=e.database();c.command;function s(e){var t={};for(var a in o.validator)e.includes(a)&&(t[a]=o.validator[a]);return t}var d={data:function(){var e={phone_id:"",edit:"",ram:null,rom:null,money:"",sort:0};return{formData:e,formOptions:{ram_localdata:[{value:4,text:4},{value:6,text:6},{value:8,text:8},{value:12,text:12},{value:16,text:16},{value:18,text:18}],rom_localdata:[{value:32,text:32},{value:64,text:64},{value:128,text:128},{value:256,text:256},{value:512,text:512},{value:1024,text:1024}]},rules:(0,u.default)({},s(Object.keys(e)))}},onLoad:function(e){if(e.id){var t=e.id;this.formDataId=t,this.getDetail(t)}},onReady:function(){this.$refs.form.setRules(this.rules)},methods:{onchange:function(e){var t=this;return(0,i.default)((0,r.default)().mark((function a(){var n;return(0,r.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,(0,l.relevance)(e);case 2:if(n=a.sent,"200"!=n){a.next=6;break}return setTimeout((function(){t.formData.phone_id=null}),800),a.abrupt("return");case 6:t.formData.edit=n;case 7:case"end":return a.stop()}}),a)})))()},submit:function(){var e=this;uni.showLoading({mask:!0}),this.$refs.form.validate().then((function(t){return e.submitForm(t)})).catch((function(){})).finally((function(){uni.hideLoading()}))},submitForm:function(e){var t=this;return c.collection("Mmoney").doc(this.formDataId).update(e).then((function(e){uni.showToast({title:"修改成功"}),t.getOpenerEventChannel().emit("refreshData"),setTimeout((function(){return uni.navigateBack()}),500)})).catch((function(e){uni.showModal({content:e.message||"请求服务失败",showCancel:!1})}))},getDetail:function(e){var t=this;uni.showLoading({mask:!0}),c.collection("Mmoney").doc(e).field("phone_id,edit,ram,rom,money,sort").get().then((function(e){var a=e.result.data[0];a&&(t.formData=a)})).catch((function(e){uni.showModal({content:e.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))}}};t.default=d}).call(this,a("a9ff")["default"])}}]);